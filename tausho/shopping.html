<!doctype html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>Shopping Tausho</title>
    <link rel="stylesheet" href="stylesheet.css">
    <script src="https://unpkg.com/vue@next"></script>
</head>

<body>
    <header>
        お買い物リスト
    </header>

    <div class="body" id="app">
        <table id="table">
            <tr>
                <th></th>
                <th>商品名</th>
                <th>税抜価格</th>
                <th>税率</th>
                <th>税込価格</th>
            </tr>
            <tr>
                <td>
                    <button type="button" onclick="rowdel(this)">削除</button>
                </td>
                <td>
                    <input type="text">
                </td>
                <td>
                    <input type="number" value="0" id="price1" min="1" onfocus="priceCalc(this)" onkeyup="priceCalc(this)">円
                </td>
                <td>
                    <input type="radio" id = "tax-rate1" name="tax-form1" checked="checked" onclick="priceCalc(this)"> 8%
                    <input type="radio" name="tax-form1" onclick="priceCalc(this)"> 10%
                </td>
                <td>
                    <span id="ans1">0</span>円
                </td>
            </tr>

        </table>
        <button class="add-row" type="button" v-on:click="rowaddVue">追加 {{message}} {{count}}</button>
    </div>

    <div class="footer">
        合計
    </div>

    <script>
        const HelloVueApp = {
            data() {
                return {
                    message: 'Hello Vue.js!',
                    count: 0,
                }
            },
            methods: {
                rowaddVue() {
                    console.log('rowaddVue');
                    this.count++;
                    rowadd();
                },
            }
        }
        Vue.createApp(HelloVueApp).mount('#app');

        const priceCalc = (obj) => {
            //選択した行数を取得
            var rows = obj.parentNode.parentNode.rowIndex
            //その行の税抜き価格を取得
            var price = document.getElementById(`price${rows}`).value;
            //税率
            var taxRate;
            var element = document.getElementById(`tax-rate${rows}`) ;

            if(element.checked){
                taxRate = 1.08;

            }else{
                taxRate = 1.1;
            }
            //税込価格を計算し、出力
            document.getElementById(`ans${rows}`).innerHTML = price * taxRate;
        }

        const rowadd = () => {
            var table = document.getElementById("table");
            // 行数を取得
            var rows = table.rows.length;
            // 行を行末に追加
            var row = table.insertRow(-1);
            //td分追加
            var cell1 = row.insertCell(-1);
            var cell2 = row.insertCell(-1);
            var cell3 = row.insertCell(-1);
            var cell4 = row.insertCell(-1);
            var cell5 = row.insertCell(-1);
            // セルの内容入力
            cell1.innerHTML = `<button type="button" onclick="rowdel(this)">削除</button>`;
            cell2.innerHTML = `<input type="text">`;
            cell3.innerHTML = `<input type="number" value="0" id="price${rows}" min="1" onfocus="priceCalc(this)" onkeyup="priceCalc(this)">円`;
            cell4.innerHTML = `<input type="radio" id = tax-rate${rows} name="tax-form${rows}" checked="checked" onclick="priceCalc(this)"> 8%<input type="radio" name="tax-form${rows}" onclick="priceCalc(this)"> 10%`;
            cell5.innerHTML = `<span id="ans${rows}">0</span>円`;

        }
        const rowdel = (obj) => {
            // 削除ボタンを押下された行を取得
            tr = obj.parentNode.parentNode;
            // trのインデックスを取得して行を削除する
            tr.parentNode.deleteRow(tr.sectionRowIndex);
        }
    </script>
</body>

</html>